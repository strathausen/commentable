#extend("base"):
    #export("body"):
        <div class="container">
            <header class="page-header">
                <div>
                    <h1>#(website.name)</h1>
                    <p class="domain">#(website.domain)</p>
                </div>
                <div class="page-actions">
                    <button id="editWebsiteBtn" class="btn-small">Edit</button>
                    <button id="archiveWebsiteBtn" class="btn-small">Archive</button>
                </div>
            </header>

            <!-- Collapsible Embed Code Section -->
            <div class="embed-sticky">
                <button class="embed-toggle collapsed" id="embedToggle">
                    <span class="toggle-icon">▼</span>
                    Integration Code
                </button>
                <div class="embed-content collapsed" id="embedContent">
                    <div class="embed-options">
                        <div class="embed-option">
                            <h3>Embed Code (iframe)</h3>
                            <pre><code id="embedCode">#(embedCode)</code></pre>
                            <button class="btn-small" onclick="copyToClipboard('embedCode')">Copy Embed Code</button>
                        </div>
                        <div class="embed-option">
                            <h3>Standalone Link</h3>
                            <pre><code id="standaloneLink">#(standaloneLink)</code></pre>
                            <button class="btn-small" onclick="copyToClipboard('standaloneLink')">Copy Link</button>
                            <p class="warning">⚠️ Important: Add <code>?path=/your-page-path</code> parameter when using this link!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <nav class="tab-nav">
                <button class="tab-button active" data-tab="comments">Comments</button>
                <button class="tab-button" data-tab="moderation">Moderation</button>
                <button class="tab-button" data-tab="pages">Pages</button>
                <button class="tab-button" data-tab="style">Style</button>
            </nav>

            <!-- Comments Tab -->
            <div class="tab-content active" id="tab-comments">
                <section class="comments-section">
                    <div class="section-header">
                        <h2>Comments (#(commentCount))</h2>
                        <div class="filter-tabs">
                            <button class="filter-tab active" data-filter="all">All</button>
                            <button class="filter-tab" data-filter="pending">Pending</button>
                            <button class="filter-tab" data-filter="approved">Approved</button>
                            <button class="filter-tab" data-filter="rejected">Rejected</button>
                        </div>
                    </div>
                    #if(count(comments) > 0):
                        <div class="comments-list-detail">
                            #for(comment in comments):
                                <div class="comment-card-detail" data-status="#(comment.status)">
                                    <div class="comment-header-row">
                                        <div class="comment-left">
                                            <span class="comment-status status-#(comment.status)">#(comment.status)</span>
                                            #if(comment.manuallyModerated):
                                                <span class="manual-badge-inline">Manual</span>
                                            #endif
                                            <span class="comment-author-inline">#if(comment.authorName):#(comment.authorName)#else:Anonymous#endif</span>
                                        </div>
                                        <div class="comment-right">
                                            <span class="comment-date-inline">#if(comment.createdAt):#date(comment.createdAt)#endif</span>
                                        </div>
                                    </div>
                                    <div class="comment-content-main">#(comment.content)</div>
                                    <div class="comment-footer-row">
                                        <span class="comment-page-inline">#(comment.pagePath)</span>
                                        <div class="comment-actions-inline">
                                            #if(comment.status != "approved"):
                                                <button class="btn-action approve-comment" data-id="#(comment.id)">Approve</button>
                                            #endif
                                            #if(comment.status != "rejected"):
                                                <button class="btn-action reject-comment" data-id="#(comment.id)">Reject</button>
                                            #endif
                                        </div>
                                    </div>
                                </div>
                            #endfor
                        </div>
                    #else:
                        <p class="empty-state">No comments yet.</p>
                    #endif
                </section>
            </div>

            <!-- Moderation Tab -->
            <div class="tab-content" id="tab-moderation">
                <section class="prompts-section">
                    <div class="section-header">
                        <h2>Moderation Prompts (#(promptCount))</h2>
                        <button id="addPromptBtn" class="btn">Add Prompt</button>
                    </div>

                    <div class="info-box">
                        <p>Custom prompts enforce specific rules for your community in addition to OpenAI's standard moderation.</p>
                    </div>

                    #if(count(prompts) > 0):
                        <div class="prompts-list">
                            #for(prompt in prompts):
                                <div class="prompt-card">
                                    <div class="prompt-header">
                                        <span class="prompt-status status-#if(prompt.isActive):active#else:inactive#endif">
                                            #if(prompt.isActive):Active#else:Inactive#endif
                                        </span>
                                        <div class="prompt-actions">
                                            <button class="btn-small toggle-prompt" data-id="#(prompt.id)" data-active="#(prompt.isActive)">
                                                #if(prompt.isActive):Deactivate#else:Activate#endif
                                            </button>
                                            <button class="btn-small delete-prompt" data-id="#(prompt.id)">Delete</button>
                                        </div>
                                    </div>
                                    <div class="prompt-content">#(prompt.prompt)</div>
                                </div>
                            #endfor
                        </div>

                        <div class="rerun-section">
                            <button id="rerunBtn" class="btn">Re-run Moderation on Pending Comments</button>
                            <p class="help-text">Re-moderates pending comments. Manually moderated comments will not be affected.</p>
                        </div>
                    #else:
                        <p class="empty-state">No moderation prompts yet.</p>
                    #endif
                </section>
            </div>

            <!-- Pages Tab -->
            <div class="tab-content" id="tab-pages">
                <section class="pages-section">
                    <h2>Pages (#(pageCount))</h2>
                    #if(count(pages) > 0):
                        <div class="pages-list">
                            #for(page in pages):
                                <div class="page-item">
                                    <span class="page-path">#(page.path)</span>
                                    <span class="page-comments">#(page.commentCount) comments</span>
                                </div>
                            #endfor
                        </div>
                    #else:
                        <p class="empty-state">No pages yet. Pages are created automatically when the embed is used.</p>
                    #endif
                </section>
            </div>

            <!-- Style Tab -->
            <div class="tab-content" id="tab-style">
                <section class="style-section">
                    <div class="style-selector-container">
                        <div class="style-options">
                            <h2>Choose a Style</h2>
                            <p class="style-description">Select a pre-designed theme for your comment widget.</p>

                            <div class="style-list">
                                <label class="style-option #if(website.style == "commentable"):active#endif">
                                    <input type="radio" name="style" value="commentable" #if(website.style == "commentable"):checked#endif>
                                    <div class="style-preview-small">
                                        <div class="style-name">Commentable</div>
                                        <div class="style-tags">Courier New • Bold borders • Shadows</div>
                                    </div>
                                </label>

                                <label class="style-option #if(website.style == "sleek"):active#endif">
                                    <input type="radio" name="style" value="sleek" #if(website.style == "sleek"):checked#endif>
                                    <div class="style-preview-small">
                                        <div class="style-name">Sleek</div>
                                        <div class="style-tags">Vollkorn • Yellow tint • Elegant</div>
                                    </div>
                                </label>

                                <label class="style-option #if(website.style == "bear"):active#endif">
                                    <input type="radio" name="style" value="bear" #if(website.style == "bear"):checked#endif>
                                    <div class="style-preview-small">
                                        <div class="style-name">Bear</div>
                                        <div class="style-tags">Verdana • Minimal • Clean</div>
                                    </div>
                                </label>
                            </div>

                            <button id="saveStyleBtn" class="btn">Save Style</button>
                            <div id="styleError" class="error"></div>
                        </div>

                        <div class="style-preview-live">
                            <h3>Live Preview</h3>
                            <iframe id="stylePreviewFrame" src="/embed/#(website.id)?path=/preview&style=#(website.style)" frameborder="0"></iframe>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Add Prompt Modal -->
        <div id="addPromptModal" class="modal">
            <div class="modal-content">
                <h2>Add Moderation Prompt</h2>
                <form id="addPromptForm">
                    <div class="form-group">
                        <label for="prompt">Prompt</label>
                        <textarea id="prompt" name="prompt" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="isActive" name="isActive" checked>
                            Active
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn">Add</button>
                        <button type="button" id="cancelPromptBtn" class="btn">Cancel</button>
                    </div>
                    <div id="promptError" class="error"></div>
                </form>
            </div>
        </div>

        <!-- Edit Website Modal -->
        <div id="editWebsiteModal" class="modal">
            <div class="modal-content">
                <h2>Edit Website</h2>
                <form id="editWebsiteForm">
                    <div class="form-group">
                        <label for="editName">Name</label>
                        <input type="text" id="editName" value="#(website.name)" required>
                    </div>
                    <div class="form-group">
                        <label for="editDomain">Domain</label>
                        <input type="text" id="editDomain" value="#(website.domain)" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn">Save</button>
                        <button type="button" id="cancelEditBtn" class="btn">Cancel</button>
                    </div>
                    <div id="editError" class="error"></div>
                </form>
            </div>
        </div>

        <script src="/js/website-detail.js"></script>
    #endexport
#endextend
